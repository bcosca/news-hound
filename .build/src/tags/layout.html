<news:layout tag="cc:basecoat">
  <main tag="cc:main" class="col" ref="main">
    <header tag="news:header" class="top" ref="top"></header>
    <div tag="cc:progress" class="indeterminate" ref="progress"></div>
    <div class="container" ref="content"></div>
  </main>
  <style>
  html,body {
    width:480px;
    scrollbar-color:var(--shaded) transparent;
    scrollbar-width:thin;
  }
  img {
    background-color:var(--shaded);
  }
  p:empty {
    display:none;
  }
  </style>
  <script>
  document.title=props.app.brand;

  let self=this;

  this.once('ready',function() {
    let progress=refs.progress.expose(),
        content=refs.content.expose();
    function rss() {
      let xhr=new XMLHttpRequest();
      xhr.open('GET','https://news.google.com/rss');
      xhr.addEventListener('load',function() {
        let xml=xhr.responseXML,
            url=xml.querySelector('channel>link'),
            stamp=xml.querySelector('lastBuildDate');
        xml.querySelectorAll('channel>item').forEach(function(item) {
          content.appendChild(document.createElement('div'));
          self.getRef(content.lastElementChild).
            inject({ item }).
            addTag('news:item').
            load();
        });
        progress.style.display='none';
        refs.top.emit('icon:stop');
      });
      xhr.addEventListener('error',function() {
        refs.content.addTag('news:offline').load();
        progress.style.display='none';
        refs.top.emit('icon:stop');
      });
      xhr.send();
    }
    this.inject({
      layout:this,
      main:refs.main,
      progress:refs.progress
    });
    this.on('news:refresh',function() {
      refs.top.emit('icon:spin');
      progress.style.display='block';
      while (content.firstChild)
        content.firstChild.remove();
      rss();
    });
  });
  </script>
</news:layout>

