{"version":3,"sources":["src/tags/item.html","src/tags/layout.html","src/js/_boot.js"],"names":["roadshow","register","props","refs","desc","item","querySelector","photo","pub","Date","textContent","tmp","document","createElement","innerHTML","replace","test","content","firstElementChild","tagName","first","frag","createDocumentFragment","firstChild","appendChild","insertBefore","remove","querySelectorAll","forEach","element","setAttribute","matches","classList","add","removeAttribute","parentElement","time","ref","getTime","diff","abs","Math","unit","when","units","year","month","week","day","hour","minute","i","trunc","timeDiff","div","this","expose","img","getAttribute","style","objectFit","addEventListener","display","css","foreground","theme","surface","title","app","brand","timeout","self","once","icon","reload","find","shift","inject","layout","snackbar","main","on","e","preventDefault","xhr","XMLHttpRequest","open","progress","xml","responseXML","getRef","lastElementChild","addTag","load","floor","random","emit","clearTimeout","setTimeout","console","log","send","rss","bind","primary","primaryAlt"],"mappings":"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","sourcesContent":["<news:item tag=\"cc:card\" class=\"flex p-2 my-2\">\n  <style>\n  a {\n    color:${ props.css.foreground(props.theme.surface) };\n  }\n  </style>\n  <script>\n\t/* Compute time difference between two Unix timestamps */\n\tfunction timeDiff(time,ref) {\n\t\tif (!ref)\n\t\t\t// Get current time if second argument is not specified\n\t\t\tref=new Date().getTime()/1e3;\n\t\tlet diff=time-ref,\n        abs=Math.abs(diff);\n\t\tif (!abs)\n\t\t\treturn 'Just now';\n\t\tlet when=diff>0?'from now':'ago',\n        units={\n          year:31.536e6,\n          month:2.592e6,\n          week:604.8e3,\n          day:86.4e3,\n          hour:3.6e3,\n          minute:60\n        },\n        unit;\n\t\tfor (let i in units)\n\t\t\tif (abs>=units[i]) {\n        unit=Math.trunc(abs/units[i]);\n\t\t\t\treturn /day/.test(i) && !(unit-1)?\n\t\t\t\t\t(diff>0?'tomorrow':'yesterday'):\n\t\t\t\t\t(unit+' '+i+((unit-1)?'s':'')+' '+when);\n      }\n    unit=Math.trunc(abs);\n\t\treturn unit+' second'+((unit-1)?'s':'')+' '+when;\n\t}\n\n  // Extract RSS elements\n  let desc=props.item.querySelector('description'),\n      photo=props.item.querySelector('content'),\n      pub=new Date(props.item.querySelector('pubDate').textContent),\n      tmp=document.createElement('template');\n  tmp.innerHTML=(\n    desc.textContent.\n      replace(/<(\\/)?ol>/,'<$1ul>').\n      replace(/&nbsp;/g,' ')\n  );\n  if (/^ul/i.test(tmp.content.firstElementChild.tagName)) {\n    // Restructure HTML\n    let first=tmp.content.querySelector('li:first-child'),\n        frag=document.createDocumentFragment();\n    while (first.firstChild)\n      frag.appendChild(first.firstChild);\n    tmp.content.insertBefore(frag,tmp.content.firstElementChild);\n    first.remove();\n    // Remove link to Google News page\n    tmp.content.querySelector('li:last-child').remove();\n  }\n\n  // Tweak formatting\n  tmp.content.querySelectorAll('strong').forEach(function(element) {\n    element.remove();\n  });\n  tmp.content.querySelectorAll('p,ul').forEach(function(element) {\n    element.setAttribute('class','small mt-1 mb-0');\n    if (element.matches('ul'))\n      element.classList.add('pl-2');\n  });\n  tmp.content.querySelectorAll('font').forEach(function(element) {\n    element.setAttribute('class','text-muted nobr');\n    element.removeAttribute('color');\n    if (!element.parentElement) {\n      element.classList.add('small');\n      // Add human-readable timestamp\n      element.innerHTML+=' Â· '+timeDiff(pub.getTime()/1e3);\n    }\n  });\n\n  // Wrap news item in a div element\n  let div=document.createElement('div');\n  div.setAttribute('class','grow');\n  div.appendChild(tmp.content);\n  this.expose().appendChild(div);\n\n  if (photo) {\n    let img=document.createElement('img');\n    img.setAttribute('src',photo.getAttribute('url'));\n    img.setAttribute('width',96);\n    img.setAttribute('height',72);\n    img.style.objectFit='cover';\n    img.setAttribute('class','noflex ml-2');\n    img.addEventListener('error',function() {\n      // Hide broken links\n      img.style.display='none';\n    });\n    this.expose().appendChild(img);\n  }\n  </script>\n</news:item>\n","<news:layout tag=\"cc:basecoat\">\n  <main tag=\"cc:main\" class=\"col\" ref=\"main\">\n    <header tag=\"cc:sheet\" class=\"top\" ref=\"top\">\n      <div tag=\"cc:appbar\" class=\"primary\" ref=\"appbar\">\n        <a class=\"title ml-1 mr-auto\" href=\".\">${ document.title }</a>\n        <a class=\"mx-1\" href=\"#\" ref=\"reload\"><i class=\"icon icon-refresh infinite\"></i></a>\n      </div>\n    </header>\n    <div tag=\"cc:progress\" class=\"indeterminate\" ref=\"progress\"></div>\n    <div class=\"container\" ref=\"content\"></div>\n    <footer tag=\"cc:sheet\" class=\"bottom\" ref=\"bottom\">\n      <div tag=\"cc:snackbar\" ref=\"snackbar\">\n        <div class=\"py-1 ml-1 mr-auto\">Support further development of ${ props.app.brand }. Your donations help keep this project ad-free.</div>\n        <a tag=\"cc:button\" class=\"primary solid ml-2 mr-1\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3VSK6CKUYZRBL&source=url\" target=\"_blank\">Donate</a>\n      </div>\n    </footer>\n  </main>\n  <style>\n  html,body {\n    width:480px;\n    scrollbar-color:var(--shaded) transparent;\n    scrollbar-width:thin;\n  }\n  img {\n    background-color:var(--shaded);\n  }\n  p:empty {\n    display:none;\n  }\n  </style>\n  <script>\n  document.title=props.app.brand;\n\n  let self=this,\n      timeout;\n\n  this.once('ready',function() {\n    let icon=refs.reload.find('.icon').shift().expose();\n    function rss() {\n      let xhr=new XMLHttpRequest();\n      xhr.open('GET','https://news.google.com/rss');\n      xhr.addEventListener('load',function() {\n        refs.progress.expose().remove();\n        let xml=xhr.responseXML,\n            url=xml.querySelector('channel>link'),\n            stamp=xml.querySelector('lastBuildDate'),\n            content=refs.content.expose();\n        xml.querySelectorAll('channel>item').forEach(function(item) {\n          content.appendChild(document.createElement('div'));\n          self.getRef(content.lastElementChild).\n            inject({ item }).\n            addTag('news:item').\n            load();\n        });\n        icon.classList.remove('spin');\n        // Show snackbar at random times (1:3 probability)\n        if (!Math.floor(Math.random()*Math.floor(3))) {\n          refs.snackbar.emit('snackbar:show');\n          clearTimeout(timeout);\n          timeout=setTimeout(function() {\n            refs.snackbar.emit('snackbar:hide');\n          },30e3);\n        }\n      });\n      xhr.addEventListener('error',function() {\n        console.log(xhr);\n      });\n      xhr.send();\n    }\n    this.inject({\n      layout:this,\n      snackbar:refs.snackbar,\n      main:refs.main\n    });\n    let content=refs.content.expose();\n    refs.reload.\n      on('click',function(e) {\n        e.preventDefault();\n        icon.classList.add('spin');\n        while (content.firstChild)\n          content.firstChild.remove();\n        rss();\n      }.bind(this)).\n      emit('click');\n  });\n  </script>\n</news:layout>\n\n","/* global roadshow */\n\n'use strict';\n\n(function() {\n\n  roadshow.load({\n    app:{\n      brand:'News Hound'\n    },\n    theme:{\n      primary:'red-700',\n      primaryAlt:'red-a700'\n    }\n  });\n\n})();\n"]}