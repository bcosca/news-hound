roadshow.register("news:colophon",function(props){return`<news:colophon>\n  <div class="reverse p-1">\n    <div class="m-1">\n      <div><strong>About News Hound</strong></div>\n      <div class="small">Version ${props.app.manifest.version}</div>\n    </div>\n    <p class="small text-muted m-1">News Hound provides up-to-date news aggregated from thousands of blogs, newspapers, and magazines around the Web.</p>\n    <div class="m-1">Support further development of ${props.app.brand}. Your donations help keep this project ad-free.</div>\n    <div class="flex p-1">\n      <a tag="cc:button" class="ml-auto mr-1" href="https://www.patreon.com/bePatron?u=20757210" target="_blank">Become a Patron!</a>\n      <a tag="cc:button" class="primary light solid ml-1" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=3VSK6CKUYZRBL&amp;source=url" target="_blank">Donate</a>\n    </div>\n  </div>\n</news:colophon>`},function(props,refs){},function(props){return""}),roadshow.register("news:item",function(props){return'<news:item tag="cc:card" class="flex my-2">\n  \n\n\n\n\n\n\n\n  \n</news:item>'},function(props,refs){let $=roadshow.$,desc=$("description",props.item).shift(),photo=$("content",props.item).shift(),pub=new Date($("pubDate",props.item).shift().textContent),tmp=document.createElement("template");tmp.innerHTML=desc.textContent.replace(/<(\/)?ol>/,"<$1ul>").replace(/&nbsp;/g," ");let headline=document.createElement("div");if(/^ul/i.test(tmp.content.firstElementChild.tagName)){let first=$("li:first-child",tmp.content).shift();for(;first.firstChild;)headline.appendChild(first.firstChild);tmp.content.insertBefore(headline,tmp.content.firstElementChild),first.remove(),$("li:last-child",tmp.content).shift().remove()}$("strong",tmp.content).forEach(function(element){element.remove()}),$("p,ul",tmp.content).forEach(function(element){element.setAttribute("class","small mt-1 mb-0"),element.matches("ul")&&element.classList.add("pl-2")}),$("font",tmp.content).forEach(function(element){element.setAttribute("class","text-muted"),element.removeAttribute("color"),element.parentElement&&element.parentElement.isSameNode(headline)&&(element.classList.add("small"),element.textContent+=" · "+function(time,ref){let format=window.ICU.format,message=chrome.i18n.getMessage;ref||(ref=Date.now()/1e3);let diff=time-ref,abs=Math.abs(diff);if(!abs)return message("timeNow");let unit,when=message(diff>0?"timeFuture":"timePast"),units={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let i in units)if(abs>=units[i])return unit=Math.trunc(abs/units[i]),!/day/.test(i)||unit-1?format(when,format(message("time"+i[0].toUpperCase()+i.substring(1)),unit)):message(diff>0?"timeTomorrow":"timeYesterday");return format(when,format(message("timeSecond"),Math.trunc(abs)))}(pub.getTime()/1e3))});let item=this.expose(),div=document.createElement("div");if(div.setAttribute("class","grow m-2"),div.appendChild(tmp.content),item.appendChild(div),photo){this.getRef(item.appendChild(document.createElement("img"))).attr({src:photo.getAttribute("url").replace(/(\-[wh])150/g,"$196"),width:96,height:72,class:"noflex cover mr-2 my-2"})}},function(props){return`.card{background-color:var(${props.app.storage.darkMode?"--shaded":"--surface"}) !important;}a{color:${props.css.foreground(props.theme.surface)};}`}),roadshow.register("news:layout",function(props){return`<news:layout tag="cc:basecoat">\n  <main tag="cc:main" ref="main">\n    <header tag="cc:sheet" class="top" ref="top">\n      <div tag="cc:appbar" class="${props.app.storage.darkMode?"reverse":"primary"}" ref="appbar">\n        <span class="title ml-1 mr-auto">\n          <img src="pub/img/logo.png" height="20" class="primary">\n        </span>\n        <button type="button" class="mx-1" ref="darkmode" title="${props.app.storage.darkMode?"Disable":"Enable"} dark mode"><i class="icon icon-invert-colors infinite"></i></button>\n        <button type="button" class="mx-1" ref="reload" title="Refresh"><i class="icon icon-refresh infinite" ref="icon"></i></button>\n      </div>\n    </header>\n    <div tag="cc:progress" class="indeterminate" ref="progress"></div>\n    <div class="container" ref="content"></div>\n    <footer ref="colophon"></footer>\n  </main>\n  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  \n</news:layout>`},function(props,refs){document.title=props.app.brand;let $=roadshow.$,self=this,api={weather:"41d8b0b419d0061751264c1fb64592f0"};this.once("ready",function(){let storage=props.app.storage,reload=(refs.main.expose(),refs.icon.expose()),content=(refs.progress.expose(),refs.content.expose());function rss(){reload.classList.add("spin"),refs.progress.css({display:"block"}),refs.content.empty(),refs.colophon.empty();let xhr=new XMLHttpRequest;xhr.open("GET","https://news.google.com/rss"),xhr.addEventListener("load",function(){navigator.geolocation.getCurrentPosition(function(pos){let now=Date.now();if(!storage.weatherDate||now/1e3-storage.weatherDate>86400){let xhr=new XMLHttpRequest;xhr.open("GET","https://api.openweathermap.org/data/2.5/weather?lat="+pos.coords.latitude+"&lon="+pos.coords.longitude+"&units=metric&APPID="+api.weather),xhr.addEventListener("load",function(){storage.weatherDate=(now-now%864e5)/1e3,storage.weatherJSON=xhr.responseText,content.insertBefore(document.createElement("div"),content.firstChild),self.getRef(content.firstElementChild).inject({item:JSON.parse(storage.weatherJSON)}).addTag("news:weather").load()}),xhr.send()}else content.insertBefore(document.createElement("div"),content.firstChild),self.getRef(content.firstElementChild).inject({item:JSON.parse(storage.weatherJSON)}).addTag("news:weather").load()}),refs.progress.css({display:"none"}),reload.classList.remove("spin"),refs.colophon.addTag("news:colophon").load();let xml=xhr.responseXML;$("lastBuildDate",xml).shift(),$("channel>link",xml).shift();storage.newsXML||(storage.newsXML=xhr.responseText),$("channel>item",xml).forEach(function(item){content.appendChild(document.createElement("div")),self.getRef(content.lastElementChild).inject({item:item}).addTag("news:item").load()})}),xhr.addEventListener("error",function(){if(refs.content.addTag("news:offline").load(),storage.newsXML){let xml=(new DOMParser).parseFromString(storage.newsXML,"application/xml");$("channel>item",xml).forEach(function(item){content.appendChild(document.createElement("div")),self.getRef(content.lastElementChild).inject({item:item}).addTag("news:item").load()})}refs.progress.css({display:"none"}),reload.classList.remove("spin")}),xhr.send()}this.inject({layout:this,main:refs.main,progress:refs.progress}),refs.reload.on("click",function(){rss()}).emit("click"),refs.darkmode.on("click",function(){storage.darkMode?delete storage.darkMode:storage.darkMode="on",window.location.reload()})})},function(props){return"body{width:480px;}html,body{scrollbar-color:var(--shaded) transparent;scrollbar-width:thin;}main{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQYV2NkQAKrVq0yZoTxQZywsLCzYAEYB8RmROaABACrOQ42LQKAagAAAABJRU5ErkJggg==);background-attachment:fixed;background-repeat:repeat;}p:empty{display:none;}.container{transition:opacity .45s linear;}.container:empty{opacity:0;}.card img{background-color:var(--shaded);}"}),roadshow.register("news:offline",function(props){return'<news:offline>\n  <div class="my-3">\n    <p class="h2 text-center text-secondary mb-2">Unable to retrieve the latest news</p>\n    <p class="text-center">Please check your Internet connection.</p>\n  </div>\n</news:offline>'},function(props,refs){},function(props){return""}),roadshow.register("news:weather",function(props){return`<news:weather tag="cc:card" class="flex flex-start p-2 my-2">\n  <div class="d4 inline text-secondary mr-2 my-0"><b>${parseInt(props.item.main.temp)}°C</b></div>\n  <div class="mr-auto">\n    <p class="small text-muted mb-0">${window.ICU.format("{0,date,long}",Date.now()/1e3)} ${props.item.name} ${props.item.sys.country}</p>\n    ${props.item.weather[0].description}\n  </div>\n  <i class="d4 text-secondary wi wi-owm-${props.item.weather[0].id} my-0" title="${props.item.weather[0].main}"></i>\n</news:weather>`},function(props,refs){},function(props){return""}),window.ICU=window.ICU||{format(){let pos,options,stamp,regex=/\{\s*(\d+)\s*(?:,\s*(\w+)\s*(?:,\s*((?:\w+(?:\s*\{.+?\}\s*,?\s*)?)*)(?:,\s*(.+?))?)?)?\s*\}/g,str=arguments[0],match=regex.exec(arguments[0]);for(;match;){if((pos=parseInt(match[1])+1)in arguments)if(match.length>1&&match[2]){let args=[navigator.language||navigator.userLanguage];switch(match[2]){case"number":if(match.length>2&&match[3])switch(match[3]){case"integer":arguments[pos]=parseInt(arguments[pos]);break;case"currency":options={style:"decimal",maximumFractionDigits:2};break;case"percent":options={style:"percent"}}options&&args.push(options),str=str.replace(match[0],arguments[pos].toLocaleString.apply(arguments[pos],args));break;case"date":if(stamp=new Date(1e3*arguments[pos]),match.length>2&&match[3])switch(options={year:"numeric",month:"numeric",day:"numeric"},match[3]){case"long":options.month="long";break;case"full":options.weekday="long"}options&&args.push(options),str=str.replace(match[0],stamp.toLocaleDateString.apply(stamp,args));break;case"time":stamp=new Date(1e3*arguments[pos]),options=match.length>2&&match[3]&&/long/.test(match[3])?{hour:"2-digit",minute:"2-digit",second:"2-digit"}:{hour12:!1},args.push(options),str=str.replace(match[0],stamp.toLocaleTimeString.apply(stamp,args));break;case"plural":if(match.length>2&&match[3]){let data,pattern=/(\w+)(?:\s*\{\s*(.+?)\s*\})/g,tmp=pattern.exec(match[3]),ord=["zero","one","two"];for(;tmp;){if(arguments[pos]in ord&&tmp[1]==ord[arguments[pos]]||/other/.test(tmp[1])){data=tmp[2].replace("#",arguments[pos]);break}tmp=pattern.exec(match[3])}str=str.replace(match[0],data)}}}else str=str.replace(match[0],arguments[pos]);match=regex.exec(arguments[0])}return str}},function(){let manifest=chrome.runtime.getManifest(),storage=window.localStorage;roadshow.load({app:{brand:manifest.name,manifest:manifest,storage:storage},theme:storage.darkMode?{background:"gray-800",surface:"gray-900",primary:"blue-900",primaryAlt:"blue-200",secondary:"amber-700",secondaryAlt:"amber-a700",muted:"blue-gray-200"}:{background:"gray-200",primary:"red-700",primaryAlt:"red-a700",secondary:"amber-700",secondaryAlt:"amber-a700"}})}();
