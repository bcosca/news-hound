roadshow.register("news:colophon",function(props){return`<news:colophon>\n  <div class="flex flex-middle px-2 pt-1 pb-3">\n    ${Object.keys(props.social).map(function(key){return`\n    <a class="mx-1" href="${props.social[key][1].replace("[url]",encodeURIComponent("https://chrome.google.com/webstore/detail/news-hound/oldaaikodjfajkjopadhhbkbmlgejdpb")).replace("[title]",encodeURIComponent(props.app.brand)).replace("[desc]",encodeURIComponent(props.app.manifest.description))}" target="_blank" title="${props.social[key][0]}">\n      <img class="noflex social" src="pub/img/social/${key}.png" height="32" width="32">\n    </a>\n    `}).join("\n")}\n  </div>\n  <div class="reverse p-1">\n    <div class="flex flex-center m-1">\n      <div class="mr-auto">\n        <big class="text-secondary"><strong>${props.app.brand}</strong></big> ${props.app.manifest.version}\n      </div>\n      <a class="ml-2" href="https://chrome.google.com/webstore/detail/news-hound/oldaaikodjfajkjopadhhbkbmlgejdpb" target="_blank" title="Chrome Web Store">\n        <img class="noflex" src="pub/img/chrome.png" height="24" width="24">\n      </a>\n      <a class="ml-2" href="https://addons.mozilla.org/en-US/firefox/addon/news-hound/" target="_blank" title="Firefox Add-ons">\n        <img class="noflex" src="pub/img/firefox.png" height="24" width="24">\n      </a>\n      <a class="ml-2" href="https://github.com/bcosca/news-hound" target="_blank" title="Github">\n        <img class="noflex" src="pub/img/github.png" height="24" width="24">\n      </a>\n    </div>\n    <div class="mx-3 my-1">Support further development of ${props.app.brand}. Your donations help keep this project ad-free.</div>\n    <div class="flex p-1">\n      <a tag="cc:button" class="ml-auto mr-1" href="https://www.patreon.com/bePatron?u=20757210" target="_blank">Become a Patron!</a>\n      <a tag="cc:button" class="primary light solid ml-1" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=3VSK6CKUYZRBL&amp;source=url" target="_blank">Donate</a>\n    </div>\n  </div>\n  \n</news:colophon>`},function(props,refs){props.social={facebook:["Facebook","https://www.facebook.com/share.php?u=[url]"],twitter:["Twitter","https://twitter.com/share?url=[url]&text=[title]"],"google-plus":["Google+","https://plus.google.com/share?url=[url]"],linkedin:["LinkedIn","https://www.linkedin.com/shareArticle?url=[url]&title=[title]"],pinterest:["Pinterest","http://pinterest.com/pin/create/link/?url=[url]"],reddit:["Reddit","http://www.reddit.com/submit?url=[url]&title=[title]"],tumblr:["Tumblr","https://www.tumblr.com/share/link?url=[url]&name=[title]&description=[desc]"],stumbleupon:["StumbleUpon","http://www.stumbleupon.com/submit?url=[url]&title=[title]"]}},function(props){return""}),roadshow.register("news:item",function(props){return'<news:item tag="cc:card" class="news-item flex my-2">\n  \n\n\n\n\n\n\n\n\n  \n</news:item>'},function(props,refs){let $=roadshow.$,desc=(window.localStorage,$("description",props.item).shift().textContent),photo=$('content[medium="image"]',props.item).shift(),pub=new Date($("pubDate",props.item).shift().textContent),tmp=document.createElement("template");this.ref(tmp).html(desc.replace(/<(\/)?ol>/,"<$1ul>").replace(/&nbsp;/g," "));let first,headline=document.createElement("div");if(this.ref(headline).attr({class:"mb-1"}),/^ul/i.test(tmp.content.firstElementChild.tagName)){for(first=$("li:first-child",tmp.content).shift();first.firstChild;)headline.appendChild(first.firstChild);tmp.content.insertBefore(headline,tmp.content.firstElementChild),first.remove(),$("li:last-child",tmp.content).shift().remove()}else{for(;tmp.content.firstChild&&(tmp.content.firstChild.nodeType!=window.Node.ELEMENT_NODE||!/^p/i.test(tmp.content.firstChild.tagName));)headline.appendChild(tmp.content.firstChild);tmp.content.insertBefore(headline,tmp.content.firstElementChild)}$("strong",tmp.content).forEach(function(element){element.remove()}),$("p,ul",tmp.content).forEach(function(element){element.setAttribute("class","small my-0"),element.matches("ul")&&this.ref(element).class.add("pl-2")}.bind(this)),$("font",tmp.content).forEach(function(element){let ref=this.ref(element);ref.attr({class:"text-muted"}).attr.remove("color"),element.parentElement&&!element.parentElement.isSameNode(headline)||ref.class.add("nobr small").text(ref.text()+" · "+function(time,ref){let format=window.ICU.format,message=chrome.i18n.getMessage;ref||(ref=Date.now()/1e3);let diff=time-ref,abs=Math.abs(diff);if(!abs)return message("timeNow");let unit,when=message(diff>0?"timeFuture":"timePast"),units={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60};for(let i in units)if(abs>=units[i])return unit=Math.trunc(abs/units[i]),!/day/.test(i)||unit-1?format(when,format(message("time"+i[0].toUpperCase()+i.substring(1)),unit)):message(diff>0?"timeTomorrow":"timeYesterday");return format(when,format(message("timeSecond"),Math.trunc(abs)))}(pub.getTime()/1e3))}.bind(this));let item=this.expose(),div=document.createElement("div");if(div.setAttribute("class","grow p-2"),div.appendChild(tmp.content),item.appendChild(div),photo){let img=document.createElement("img");this.ref(img).attr({src:photo.getAttribute("url").replace(/(\-[wh])150/g,"$196"),width:96,height:72,class:"noflex cover mr-2 my-2",style:"cursor:pointer"}).on("load",function(){item.appendChild(img)}).on("click",function(){let zoom=props.zoom.expose(),ref=props.zoom.find(".card").shift();ref.empty();let card=ref.expose(),clone=card.appendChild(img.cloneNode());this.ref(clone).attr({src:photo.getAttribute("url").replace(/(\-[wh])150/g,"$1448"),width:448,height:448,class:"cover m-0 close"}).on("click",function(e){props.zoom.emit("sheet:hide")}),clone=card.appendChild(headline.cloneNode(!0)),this.ref(clone).attr({class:"p-2"}),this.ref(zoom).class.add("active")})}},function(props){return`.news-item{background-color:var(--surface) !important;position:relative;}a{color:${props.css.foreground(props.theme.surface)};}`}),roadshow.register("news:layout",function(props){return`<news:layout>\n  <main tag="cc:main">\n    <header tag="cc:sheet" class="top" ref="top">\n      <div tag="cc:appbar" class="${props.app.storage.darkMode?"reverse":"primary"}">\n        <span class="title mx-1 relative" ref="title">\n          <img src="pub/img/logo.png" height="20">\n        </span>\n        <button type="button" class="mx-1" ref="search" title="Search"><i class="icon icon-search infinite"></i></button>\n        <button type="button" class="mx-1" ref="darkmode" title="Toggle dark mode"><i class="icon ${props.app.storage.darkMode?"icon-invert-colors-off":"icon-invert-colors"} infinite"></i></button>\n        <button type="button" class="mx-1" ref="reload" title="Refresh"><i class="icon icon-refresh infinite" ref="icon"></i></button>\n      </div>\n      <template id="search">\n        <input type="search">\n        <button type="button" class="absolute top right mx-1" ref="cancel" title="Cancel"><i class="icon icon-cancel"></i></button>\n      </template>\n    </header>\n    <div class="container" ref="content"></div>\n    <footer ref="colophon"></footer>\n  </main>\n  <div tag="cc:dialog" ref="imgzoom"></div>\n  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  \n</news:layout>`},function(props,refs){document.title=props.app.brand;let $=roadshow.$,self=this,storage=props.app.storage,timeout=7500,api={weather:"41d8b0b419d0061751264c1fb64592f0"};this.once("ready",function(){this.inject({layout:this,zoom:refs.imgzoom});refs.icon.expose();let content=refs.content.expose();function rss(){refs.reload.class.add("spin infinite"),refs.content.empty(),refs.colophon.empty();let xhr=new XMLHttpRequest;function offline(){if(clearTimeout(timeout),refs.content.tag.add("news:offline").load(),storage.newsXML){let xml=(new DOMParser).parseFromString(storage.newsXML,"application/xml");$("channel>item",xml).forEach(function(item){content.appendChild(document.createElement("div")),self.ref(content.lastElementChild).inject({item:item}).tag.add("news:item").load()})}refs.reload.class.remove("spin infinite")}xhr.open("GET","https://news.google.com/rss"+(storage.query?"/search?q="+storage.query:"")),xhr.timeout=timeout,xhr.addEventListener("load",function(){storage.query||navigator.geolocation.getCurrentPosition(function(pos){let now=Date.now()/1e3,geo={latitude:pos.coords.latitude,longitude:pos.coords.longitude};if(!storage.location||JSON.stringify(geo)!=storage.location||!storage.weatherDate||now-storage.weatherDate>28800){let xhr=new XMLHttpRequest;xhr.open("GET","https://api.openweathermap.org/data/2.5/weather?lat="+pos.coords.latitude+"&lon="+pos.coords.longitude+"&units=metric&APPID="+api.weather),xhr.timeout=timeout,xhr.addEventListener("load",function(){storage.location=JSON.stringify(geo),storage.weatherDate=now-now%28800,storage.weatherJSON=xhr.responseText,content.insertBefore(document.createElement("div"),content.firstChild),self.ref(content.firstElementChild).inject({item:JSON.parse(storage.weatherJSON)}).tag.add("news:weather").load()}),xhr.send()}else content.insertBefore(document.createElement("div"),content.firstChild),self.ref(content.firstElementChild).inject({item:JSON.parse(storage.weatherJSON)}).tag.add("news:weather").load()});let xml=xhr.responseXML;$("lastBuildDate",xml).shift(),$("channel>link",xml).shift();storage.newsXML||(storage.newsXML=xhr.responseText),$("channel>item",xml).forEach(function(item){content.appendChild(document.createElement("div")),self.ref(content.lastElementChild).inject({item:item}).tag.add("news:item").load()}),refs.colophon.tag.add("news:colophon").load(),refs.reload.class.remove("spin infinite")}),xhr.addEventListener("error",offline),xhr.addEventListener("timeout",offline),xhr.send()}refs.search.on("click",function(){let title=refs.title.expose(),search=refs.search.expose(),html=refs.title.html();refs.title.empty(),search.style.display="none",title.appendChild(document.getElementById("search").cloneNode(!0).content);let input=$('[type="search"]',title).shift(),cancel=$("button",title).shift();input.spellcheck=!1,storage.query&&(input.value=storage.query),this.ref(input).on("change",function(){input.value.length?(storage.query=input.value,rss()):this.ref(cancel).emit("click")}),input.focus(),this.ref(cancel).on("click",function(){refs.title.empty().html(html),search.style.display="block",delete storage.query,rss()})}),storage.query&&refs.search.emit("click"),refs.reload.on("click",rss).emit("click"),refs.darkmode.on("click",function(){storage.darkMode?delete storage.darkMode:storage.darkMode="on",window.location.reload()})})},function(props){return`body{width:480px;}html,body{scrollbar-color:var(--shaded) transparent;scrollbar-width:thin;}main{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQYV2NkQAKrVq0yZoTxQZywsLCzYAEYB8RmROaABACrOQ42LQKAagAAAABJRU5ErkJggg==);background-repeat:repeat;}p:empty{display:none;}.appbar [type="search"]{padding-right:2.5rem;}.appbar [type="search"]+button{color:${props.css.foreground(props.theme.primary)};}.container{transition:opacity .45s linear;}.container:empty{opacity:0;}.card img{background-color:var(--shaded);}`}),roadshow.register("news:offline",function(props){return'<news:offline>\n  <div class="my-3">\n    <p class="h2 text-center text-secondary mb-1">Unable to retrieve the latest news</p>\n    <p class="text-center">Please check your Internet connection.</p>\n  </div>\n</news:offline>'},function(props,refs){},function(props){return""}),roadshow.register("news:weather",function(props){return`<news:weather tag="cc:card" class="flex flex-start p-2 my-2">\n  <div class="d4 inline text-secondary mr-2 my-0"><b>${parseInt(props.item.main.temp)}°C</b></div>\n  <div class="mr-auto">\n    <p class="small text-muted mb-0">${window.ICU.format("{0,date,long}",Date.now()/1e3)} ${props.item.name} ${props.item.sys.country}</p>\n    ${props.item.weather[0].description}\n  </div>\n  <i class="d4 text-secondary wi wi-owm-${props.item.weather[0].id} my-0" title="${props.item.weather[0].main}"></i>\n  \n\n\n\n\n</news:weather>`},function(props,refs){},function(props){return".wi{vertical-align:super;}"}),window.ICU=window.ICU||{format(){let pos,options,stamp,regex=/\{\s*(\d+)\s*(?:,\s*(\w+)\s*(?:,\s*((?:\w+(?:\s*\{.+?\}\s*,?\s*)?)*)(?:,\s*(.+?))?)?)?\s*\}/g,str=arguments[0],match=regex.exec(arguments[0]);for(;match;){if((pos=parseInt(match[1])+1)in arguments)if(match.length>1&&match[2]){let args=[navigator.language||navigator.userLanguage];switch(match[2]){case"number":if(match.length>2&&match[3])switch(match[3]){case"integer":arguments[pos]=parseInt(arguments[pos]);break;case"currency":options={style:"decimal",maximumFractionDigits:2};break;case"percent":options={style:"percent"}}options&&args.push(options),str=str.replace(match[0],arguments[pos].toLocaleString.apply(arguments[pos],args));break;case"date":if(stamp=new Date(1e3*arguments[pos]),match.length>2&&match[3])switch(options={year:"numeric",month:"numeric",day:"numeric"},match[3]){case"long":options.month="long";break;case"full":options.weekday="long"}options&&args.push(options),str=str.replace(match[0],stamp.toLocaleDateString.apply(stamp,args));break;case"time":stamp=new Date(1e3*arguments[pos]),options=match.length>2&&match[3]&&/long/.test(match[3])?{hour:"2-digit",minute:"2-digit",second:"2-digit"}:{hour12:!1},args.push(options),str=str.replace(match[0],stamp.toLocaleTimeString.apply(stamp,args));break;case"plural":if(match.length>2&&match[3]){let data,pattern=/(\w+)(?:\s*\{\s*(.+?)\s*\})/g,tmp=pattern.exec(match[3]),ord=["zero","one","two"];for(;tmp;){if(arguments[pos]in ord&&tmp[1]==ord[arguments[pos]]||/other/.test(tmp[1])){data=tmp[2].replace("#",arguments[pos]);break}tmp=pattern.exec(match[3])}str=str.replace(match[0],data)}}}else str=str.replace(match[0],arguments[pos]);match=regex.exec(arguments[0])}return str}},function(){let manifest=chrome.runtime.getManifest(),storage=window.localStorage;roadshow.load({app:{brand:manifest.name,manifest:manifest,storage:storage},theme:storage.darkMode?{background:"gray-800",surface:"gray-900",primary:"blue-900",primaryAlt:"blue-200",secondary:"amber-700",secondaryAlt:"amber-a700",muted:"blue-gray-200"}:{background:"gray-200",primary:"red-700",primaryAlt:"red-a700",secondary:"amber-700",secondaryAlt:"amber-a700",muted:"blue-gray-300"}})}();
